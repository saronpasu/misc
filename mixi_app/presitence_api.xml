<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs
   title="PresistenceAPI Test"
   description="This apply is Test for PresistenceAPI."
   auhtor="saronpasu"
   author_email="jamenco@gmail.com">
    <Require feature="opensocial-0.8" />
  </ModulePrefs>
  <Content type="html" view="canvas,profile,home"><![CDATA[
    <script type="text/javascript" lang="javascript">
      function main() {
        var req = opensocial.newDataRequest();
        req.add(req.newUpdatePersonAppDataRequest(opensocial.IdSpec.PersonId.VIEWER, "name", "Tanaka"), "update_name");
        req.add(req.newUpdatePersonAppDataRequest(opensocial.IdSpec.PersonId.VIEWER, "age", "23"), "update_age");
        req.add(req.newFetchPersonAppDataRequest(opensocial.IdSpec.PersonId.VIEWER, "name", ["name", "age"]), "stored");
        req.add(req.newUpdatePersonAppDataRequest(opensocial.IdSpec.PersonId.VIEWER, "name", "Hayashi"), "re_update_name");
        // req.add(req.newRemovePersonAppDataRequest(opensocial.IdSpec.PersonId.VIEWER, "age"), "remove");
        req.send(function(response) {
          var result = "";
          if(req.hadError) {
			console.log(req.getErrorMessage());
          }
          var update_name = req.get("update_name");
          if(update_name.hadError()) {
            console.log(update_name.getErrorMessage());
          } else {
            result += "update_name: " + update_name.getData() + "<br />";
          }
          var update_age = req.get("update_age");
          if(update_age.hadError()) {
            console.log(update_age.getErrorMessage());
          } else {
            result += "update_age: " + updage_age.getData() + "<br />";
          }
          var stored = req.get("stored");
          if(stored.hadError()) {
            console.log(stored.getErrorMessage());
          } else {
            result += "stored: " + stored.getData() + "<br />";
          }
          var re_update_name = req.get("re_update_name");
          if(re_update_name.hadError()) {
            console.log(re_update_name.getErrorMessage());
          } else {
            result += "re_update_name: " + re_update_name.getData() + "<br />";
          }
          /* var remove = req.get("remove");
          if(remove.hadError()) {
            console.log(remove.getErrorMessage());
          } else {
            result += "remove: " +  remove.getData() + "<br />";
          } */
          var element = document.getElementById("main");
          element.innerHTML = result;
        });
      }

      gadgets.util.registerOnLoadHandler(main);
    </script>
    <div id="main"> </div>
  ]]></Content>
</Module>